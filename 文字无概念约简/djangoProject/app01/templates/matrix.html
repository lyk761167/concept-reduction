<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>倒计时和矩阵</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        #matrix, #blank-matrix {
            display: table;
            margin-top: 20px;
        }
        td {
            border: 1px solid #000;
            padding: 20px;
            text-align: center;
        }
        th {
            border: 1px solid #000;
            padding: 20px;
            text-align: center;
            background-color: #f0f0f0;
        }
        input {
            width: 50px;
            text-align: center;
        }
        #countdown {
            font-size: 24px;
            margin-bottom: 20px;
        }
        #comparison-result {
            margin-top: 20px;
            font-size: 20px;
            display: none;
        }
        #compare {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>

<div id="countdown">
    剩余时间: <span id="minutes"></span>分钟 <span id="seconds"></span>秒
</div>

<div id="original-content">
    <div id="matrix">
        <table>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            <tr>
                <th></th>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
            </tr>
            <tr>
                <th></th>
                <td>0</td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td>1</td>
            </tr>
            <tr>
                <th></th>
                <td>0</td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td>1</td>
                <td>0</td>
            </tr>
            <tr>
                <th></th>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
            </tr>
            <tr>
                <th></th>
                <td>0</td>
                <td>0</td>
                <td>1</td>
                <td>0</td>
                <td>1</td>
                <td>1</td>
            </tr>
            <tr>
                <th></th>
                <td>0</td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td>1</td>
                <td>1</td>
            </tr>
        </table>
    </div>
</div>

<div id="blank-matrix" style="display: none;">
    <table>
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        <tr>
            <th></th>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
        </tr>
        <tr>
            <th></th>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
        </tr>
        <tr>
            <th></th>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
        </tr>
        <tr>
            <th></th>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
        </tr>
        <tr>
            <th></th>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
        </tr>
        <tr>
            <th></th>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="0"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
            <td><input type="text" maxlength="1" data-answer="1"></td>
        </tr>
    </table>
    <button id="compare" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">比较结果</button>
    <div id="comparison-result" class="mt-4 text-xl hidden"></div>
</div>

<script>
    var countdownTime = 17 * 1000; // 30秒（毫秒）
    var countdownEndTime = new Date(new Date().getTime() + countdownTime);

    function updateCountdown() {
        var now = new Date();
        var timeDiff = countdownEndTime - now;

        if (timeDiff > 0) {
            var seconds = Math.floor(timeDiff / 1000);
            document.getElementById("minutes").textContent = Math.floor(seconds / 60);
            document.getElementById("seconds").textContent = seconds % 60;
        } else {
            document.getElementById("countdown").textContent = "倒计时结束!";
            submitAndTransition(); // 倒计时结束时自动提交并跳转
        }
    }

    function submitAndTransition() {
        document.getElementById("original-content").style.display = "none";
        document.getElementById("blank-matrix").style.display = "block";
    }

    function compareResults() {
        var inputs = document.querySelectorAll('#blank-matrix input');
        var correctCount = 0;
        var totalCount = inputs.length;

        inputs.forEach(function(input) {
            if (input.value === input.dataset.answer) {
                correctCount++;
            }
        });

        var accuracy = (correctCount / totalCount * 100).toFixed(2);
        document.getElementById("comparison-result").style.display = "block";
        document.getElementById("comparison-result").textContent = "正确率: " + accuracy + "%";
         // 打印要发送的数据
    console.log("Sending accuracy:", accuracy);

    // 发送POST请求到后端
    fetch('/save_accuracy/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')  // 如果使用了CSRF保护
        },
        body: JSON.stringify({ accuracy: accuracy })
    })
    .then(response => response.json())
    .then(data => {
        console.log(data.message);  // 打印后端返回的消息
    })
    .catch((error) => {
        console.error('Error:', error);
    });
}

// 获取cookie的辅助函数
function getCookie(name) {
    let cookieArr = document.cookie.split(";");

    for(let i = 0; i < cookieArr.length; i++) {
        let cookiePair = cookieArr[i].split("=");

        /* Removing whitespace at the beginning of the cookie name
        and compare. */
        if(name == cookiePair[0].trim()) {
            // Decode the cookie value and return
            return decodeURIComponent(cookiePair[1]);
        }
    }

    // Return null if the cookie wasn't found
    return null;
}


    document.getElementById("compare").onclick = compareResults;

    // 每秒更新一次
    setInterval(updateCountdown, 1000);
    updateCountdown(); // 立即执行一次
</script>

</body>
</html>